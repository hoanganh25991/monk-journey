<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="ScreenOrientation" content="autoRotate:disabled">
    <title>Monk Journey</title>
    <link rel="stylesheet" href="css/main.css">
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#000000">
    <meta name="description" content="A Diablo Immortal inspired game featuring a monk character">
    <meta name="orientation" content="landscape">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="images/logo-192.png">
    <link rel="apple-touch-icon" href="images/logo-192.png">
    <!-- Import Three.js from CDN -->
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.176.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.176.0/examples/jsm/"
            }
        }
    </script>
</head>

<body>
    <!-- Main Background -->
    <div id="main-background" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 100; background-image: url('assets/images/background.jpg'); background-size: cover; background-position: center center; background-repeat: no-repeat;"></div>
    
    <!-- Orientation Message -->
    <div id="orientation-message">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
            <rect x="5" y="2" width="14" height="20" rx="2" ry="2" />
            <path d="M12 18h.01" />
        </svg>
        <p>Please rotate your device to landscape mode for the best experience</p>
    </div>

    <!-- Game Container -->
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
    </div>

    <!-- Loading Screen -->
    <div id="loading-screen" style="display: none;">
        <h2>Loading Monk Journey...</h2>
        <div id="loading-bar-container">
            <div id="loading-bar"></div>
        </div>
    </div>
    
    <!-- HUD Container Elements -->
    <div id="ui-container" style="display: none;">
        <!-- Player UI -->
        <div id="player-stats-container"></div>
        
        <!-- Enemy UI -->
        <div id="enemy-health-container"></div>
        
        <!-- Skills UI -->
        <div id="skills-container"></div>
        
        <!-- Dialog Box -->
        <div id="dialog-box"></div>
        
        <!-- Inventory -->
        <div id="inventory"></div>
        
        <!-- Virtual Joystick Container -->
        <div id="virtual-joystick-container"></div>
        
        <!-- Death Screen -->
        <div id="death-screen" class="game-menu"></div>
        
        <!-- Quest Log -->
        <div id="quest-log"></div>
        
        <!-- Notifications Container -->
        <div id="notifications-container"></div>
    </div>

    <!-- Game Menu -->
    <div id="game-menu" class="game-menu" style="display: none;">
        <h1>Monk Journey</h1>
        <div class="menu-button-container">
            <button id="new-game-button" class="menu-button">New Game</button>
            <button id="load-game-button" class="menu-button" style="display: none;">Load Game</button>
            <button id="settings-menu-button" class="menu-button">Settings</button>
        </div>
    </div>

    <!-- Settings Menu -->
    <div id="main-options-menu" class="game-menu" style="display: none;">
        <div class="settings-header">
            <h1>Settings</h1>
        </div>
        
        <div class="settings-container">
            <div class="settings-tabs">
                <button id="tab-performance" class="tab-button active">Performance</button>
                <button id="tab-game" class="tab-button">Game</button>
                <button id="tab-audio" class="tab-button">Audio</button>
                <button id="tab-controls" class="tab-button">Controls</button>
                <button id="tab-model-preview" class="tab-button">Model Preview</button>
                <!-- More tabs can be added here -->
            </div>
            
            <div class="settings-content">
            <!-- Performance Settings Tab -->
            <div id="performance-tab" class="tab-content active">
                <h2 id="performance-title">Performance Settings</h2>
                <div id="performance-container" class="settings-section">
                    <div id="quality-container" class="setting-item">
                        <label for="quality-select">Quality Preset: </label>
                        <select id="quality-select"></select>
                    </div>
                    <div id="adaptive-container" class="setting-item">
                        <label for="adaptive-checkbox">Adaptive Quality: </label>
                        <input type="checkbox" id="adaptive-checkbox">
                    </div>
                    <div id="fps-container" class="setting-item">
                        <label for="fps-slider">Target FPS: </label>
                        <input type="range" id="fps-slider" min="30" max="120" step="5" value="60">
                        <span id="fps-value">60 FPS</span>
                    </div>
                </div>
            </div>
            
            <!-- Game Settings Tab -->
            <div id="game-tab" class="tab-content">
                <h2 id="game-title">Game Settings</h2>
                <div class="settings-section">
                    <div id="difficulty-container" class="setting-item">
                        <label for="difficulty-select">Difficulty: </label>
                        <select id="difficulty-select"></select>
                    </div>
                </div>
            </div>
            
            <!-- Audio Settings Tab -->
            <div id="audio-tab" class="tab-content">
                <h2 id="audio-title">Audio Settings</h2>
                <div id="audio-controls-container" class="settings-section">
                    <div id="mute-container" class="setting-item">
                        <label for="mute-checkbox">Mute Audio: </label>
                        <input type="checkbox" id="mute-checkbox">
                    </div>
                    <div id="auto-pause-container" class="setting-item">
                        <label for="auto-pause-checkbox">Auto-pause music when inactive: </label>
                        <input type="checkbox" id="auto-pause-checkbox">
                    </div>
                    <div id="music-volume-container" class="setting-item">
                        <label for="music-volume-slider">Music Volume: </label>
                        <input type="range" id="music-volume-slider" min="0" max="100" value="80">
                        <span id="music-volume-value">80%</span>
                    </div>
                    <div id="sfx-volume-container" class="setting-item">
                        <label for="sfx-volume-slider">SFX Volume: </label>
                        <input type="range" id="sfx-volume-slider" min="0" max="100" value="80">
                        <span id="sfx-volume-value">80%</span>
                    </div>
                    <div id="test-sound-container" class="setting-item">
                        <button id="test-sound-button" class="menu-button">Test Sound</button>
                    </div>
                    
                    <div id="audio-disabled-message" style="display: none;">
                        Audio is currently disabled. Audio files need to be added to the assets/audio directory.
                    </div>
                    
                    <div id="simulated-audio-note" style="display: none;">
                        Using simulated audio. For better audio experience, add audio files to the assets/audio directory.
                    </div>
                </div>
            </div>
            
            <!-- Controls Settings Tab -->
            <div id="controls-tab" class="tab-content">
                <h2 id="controls-title">Controls Settings</h2>
                <div class="settings-section">
                    <div id="keyboard-controls-container" class="setting-item">
                        <h3>Keyboard Controls</h3>
                        <div class="controls-info">
                            <div class="control-row">
                                <span class="control-key">W, A, S, D</span>
                                <span class="control-description">Movement</span>
                            </div>
                            <div class="control-row">
                                <span class="control-key">1-4</span>
                                <span class="control-description">Skills</span>
                            </div>
                            <div class="control-row">
                                <span class="control-key">Space</span>
                                <span class="control-description">Interact</span>
                            </div>
                            <!-- Escape key functionality has been removed -->
                        </div>
                    </div>
                    
                    <div id="mobile-controls-container" class="setting-item">
                        <h3>Mobile Controls</h3>
                        <div class="controls-info">
                            <div class="control-row">
                                <span class="control-key">Left Joystick</span>
                                <span class="control-description">Movement</span>
                            </div>
                            <div class="control-row">
                                <span class="control-key">Skill Buttons</span>
                                <span class="control-description">Activate Skills</span>
                            </div>
                            <div class="control-row">
                                <span class="control-key">Tap Object</span>
                                <span class="control-description">Interact</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Model Preview Tab (Dedicated) -->
            <div id="model-preview-tab" class="tab-content">
                <h2 id="model-preview-title">Model Preview</h2>
                <div class="model-preview-fullscreen-layout">
                    <div class="model-preview-fullscreen-section">
                        <div id="model-preview-fullscreen-container"></div>
                    </div>
                    <div class="model-preview-controls-section">
                        <div id="model-preview-selection" class="setting-item">
                            <label for="model-preview-select">Character Model: </label>
                            <div id="model-preview-selection-container">
                                <button id="prev-model-preview-button">◀</button>
                                <select id="model-preview-select"></select>
                                <button id="next-model-preview-button">▶</button>
                            </div>
                        </div>
                        
                        <div id="animation-preview-container" class="setting-item">
                            <label for="animation-preview-select">Animation: </label>
                            <div id="animation-preview-selection-container">
                                <button id="prev-anim-preview-button">◀</button>
                                <select id="animation-preview-select"></select>
                                <button id="next-anim-preview-button">▶</button>
                            </div>
                        </div>
                        
                        <div id="camera-controls-container" class="setting-item">
                            <h3>Camera Controls</h3>
                            <div class="camera-controls">
                                <button id="reset-camera-button" class="menu-button">Reset Camera</button>
                                <div class="camera-control-row">
                                    <label for="auto-rotate-checkbox">Auto Rotate: </label>
                                    <input type="checkbox" id="auto-rotate-checkbox">
                                </div>
                                <div class="camera-control-row">
                                    <label for="rotation-speed-slider">Rotation Speed: </label>
                                    <input type="range" id="rotation-speed-slider" min="0.5" max="5" step="0.5" value="1">
                                    <span id="rotation-speed-value">1.0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Model Settings Tab removed -->
        </div>
        
        <!-- Back Button -->
        <div class="settings-footer">
            <button id="settings-back-button" class="menu-button">Back</button>
        </div>
    </div>

    <!-- Settings Button -->
    <button id="settings-button" class="settings-button" style="display: none;">⚙️</button>

    <!-- Update Notification -->
    <div id="update-notification"
        style="display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: rgba(0, 0, 0, 0.3); color: white; padding: 10px 20px; border-radius: 5px; z-index: 1000; text-align: center; min-width: 300px; max-width: 80%;">
        <p style="margin: 0 0 10px 0;">New version available!</p>
        <div class="loading-bar"
            style="height: 5px; width: 100%; background-color: rgba(51, 51, 51, 0.5); border-radius: 2px; overflow: hidden;">
            <div id="loading-progress"
                style="height: 100%; width: 0%; background-color: #4CAF50; transition: width 0.3s;"></div>
        </div>
        <p id="update-status" style="margin: 10px 0 0 0; font-size: 0.9em;">Updating...</p>
        <p id="file-info" style="margin: 5px 0 0 0; font-size: 0.8em; color: #ddd; display: none; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"></p>
    </div>

    <!-- Orientation Lock -->
    <script src="pwa/orientation-lock.js"></script>

    <!-- Service Worker Registration -->
    <script src="pwa/registration.js"></script>
    
    <!-- Main script module -->
    <script type="module" src="js/main.js"></script>
</body>

</html>